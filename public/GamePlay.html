<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../public/style.css">
</head>

<body class="gamePlay-page">
    <div id="stage"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const stage = document.getElementById("stage");

        function spawnFromServer(batch) {
            batch.forEach(data => {
                const wrapper = document.createElement("div");
                wrapper.classList.add("animal-wrapper");
                wrapper.style.top = `${data.y}px`;
                const animal = document.createElement("div");
                animal.classList.add("animal", data.type);
                const label = document.createElement("div");
                label.classList.add("word-label", "float-text");
                label.textContent = data.word;
                wrapper.appendChild(label);
                wrapper.appendChild(animal);
                stage.appendChild(wrapper);
                let x = data.goRight ? -80 : window.innerWidth + 80;
                const speed = data.goRight ? 0.6 : -0.6;
                wrapper.style.left = `${x}px`;
                animal.style.animation = `walk 0.8s steps(4) infinite`;
                if (!data.goRight) {
                    animal.style.transform = "scaleX(-1)";
                }
                if (data.goRight) {
                    label.style.marginLeft = "0px"; 
                } else {
                    label.style.marginLeft = "-20px";
                }
                function move() {
                    x += speed;
                    wrapper.style.left = `${x}px`;
                    if ((data.goRight && x > window.innerWidth + 100) || (!data.goRight && x < -100)) {
                        wrapper.remove();
                    } else {
                        requestAnimationFrame(move);
                    }
                }
                requestAnimationFrame(move);
            });
        }
        socket.on("spawnAnimal", batch => spawnFromServer(batch));
    </script>
</body>

</html>